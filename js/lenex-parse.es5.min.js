"use strict";function Meet(){this.resultsLookup={};this.athletesLookup={};this.heatsLookup={}}function AgeDate(){}function Session(){}function Event(){}function SwimStyle(){}function AgeGroup(){}function Ranking(){}function Club(){}function Athlete(){}function Result(){}function Split(){}function Entry(){}function Heat(){this.entriesByLane=[]}function populateLenexAttributes(n,t,i){i.stringAttributes!==undefined&&i.stringAttributes.forEach(function(i){var r=t.getAttribute(i);r!=null&&(n[i]=r)});i.intAttributes!==undefined&&i.intAttributes.forEach(function(i){var r=t.getAttribute(i);r!=null&&(n[i]=parseInt(r))})}function populateLenexChildObjects(n,t,i,r){i.children!==undefined&&i.children.forEach(function(i){var c,h,w,f,v,u,e,o,y,l,p,a,s;if(i.outerElementName===undefined){for(f=t.childNodes,u=0;u<f.length;u++)if(e=f[u],e.nodeName==i.innerElementName){o=n[i.name];o===undefined?(s=new i.object,populateLenexObject(s,e,i,r),n[i.name]=s):populateLenexObject(o,e,i,r);break}}else for(c=n[i.name+"s"],c===undefined?(h=[],n[i.name+"s"]=h):h=c,w=h.length,f=t.childNodes,u=0;u<f.length;u++)if(v=f[u],v.nodeName==i.outerElementName){for(f=v.childNodes,u=0;u<f.length;u++)if(e=f[u],e.nodeName==i.innerElementName){if(o=undefined,c!==undefined)for(y={},populateLenexAttributes(y,e,i),l=0;l<w;l++)if(p=h[l],a=!0,i.identifyingAttributes.forEach(function(n){a&&p[n]!=y[n]&&(a=!1)}),a){o=p;break}o===undefined?(s=new i.object,populateLenexObject(s,e,i,r),h.push(s)):populateLenexObject(o,e,i,r)}break}})}function populateLenexObject(n,t,i,r){populateLenexAttributes(n,t,i);typeof n.populate=="function"?n.populate(t,i,r):populateLenexChildObjects(n,t,i,r)}function Lenex(n){this.urlFolderRoot=n}function HeatLaneEntry(n,t,i){this.athleteid=n;this.entrytime=t;this.entrycourse=i;this.entryTimeSeconds=parseTimeString(t)}function parseTimeString(n){var t,i;return n=="NT"?0:(t=n.split(":"),t.length!=3)?(console.warn("Can't parse time string: "+n),0):(i=parseInt(t[0])*3600,i+=parseInt(t[1])*60,i+parseFloat(t[2]))}function parseDateStr(n){var t=n.split("-");return new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))}function calcAgeAtDate(n,t){var i=t.getFullYear()-n.getFullYear(),r=n.getMonth(),u=t.getMonth();return r<u?i--:r==u&&n.getDate()<t.getDate()&&i--,i}function LenexLoad(n,t,i,r){var u=new Lenex(n);u.tryLoad("results.xml",function(){t(u)},function(){u.tryLoad("schedule.xml",function(){t(u);u.tryLoad("startlists.xml",function(){r(u)},function(){u.tryLoadSessionFiles("startlists",r)});u.tryLoadSessionFiles("results",r)},function(n){u.tryLoad("schedule.xml",r);i(n)})})}var lenexDefinition={children:[{name:"meet",outerElementName:"MEETS",innerElementName:"MEET",object:Meet,stringAttributes:["name","city","nation"],identifyingAttributes:["name","city"],children:[{name:"agedate",innerElementName:"AGEDATE",object:AgeDate,stringAttributes:["value"],identifyingAttributes:["value"]},{name:"session",outerElementName:"SESSIONS",innerElementName:"SESSION",object:Session,stringAttributes:["name","course","date"],intAttributes:["number"],identifyingAttributes:["number"],children:[{name:"event",outerElementName:"EVENTS",innerElementName:"EVENT",object:Event,stringAttributes:["gender","round"],intAttributes:["eventid","number","order"],identifyingAttributes:["eventid"],children:[{name:"swimstyle",innerElementName:"SWIMSTYLE",object:SwimStyle,stringAttributes:["name","stroke"],intAttributes:["distance","relaycount"],identifyingAttributes:["stroke","distance","relaycount"]},{name:"heat",outerElementName:"HEATS",innerElementName:"HEAT",object:Heat,intAttributes:["heatid","number"],identifyingAttributes:["heatid"]},{name:"agegroup",outerElementName:"AGEGROUPS",innerElementName:"AGEGROUP",object:AgeGroup,stringAttributes:["name"],intAttributes:["agegroupid","agemin","agemax"],identifyingAttributes:["agegroupid"],children:[{name:"ranking",outerElementName:"RANKINGS",innerElementName:"RANKING",object:Ranking,intAttributes:["place","resultid"],identifyingAttributes:["resultid"]}]}]}]},{name:"club",outerElementName:"CLUBS",innerElementName:"CLUB",object:Club,stringAttributes:["name","shortname","code","region","type"],identifyingAttributes:["code"],children:[{name:"athlete",outerElementName:"ATHLETES",innerElementName:"ATHLETE",object:Athlete,stringAttributes:["lastname","firstname","gender","birthdate","license"],intAttributes:["athleteid"],identifyingAttributes:["license"],children:[{name:"result",outerElementName:"RESULTS",innerElementName:"RESULT",object:Result,stringAttributes:["swimtime","reactiontime","status"],intAttributes:["resultid","eventid"],identifyingAttributes:["resultid"],children:[{name:"split",outerElementName:"SPLITS",innerElementName:"SPLIT",object:Split,stringAttributes:["swimtime"],intAttributes:["distance"],identifyingAttributes:["distance"]}]},{name:"entry",outerElementName:"ENTRIES",innerElementName:"ENTRY",object:Entry,stringAttributes:["entrytime","entrycourse"],intAttributes:["eventid","heatid","lane"],identifyingAttributes:["eventid","heatid"]}]}]}]}]};Meet.prototype.populate=function(n,t){populateLenexChildObjects(this,n,t,this)};Session.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);this.date=parseDateStr(this.date)};AgeDate.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);this.date=parseDateStr(this.value)};Club.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);this.athletes.forEach(function(n){n.club=this},this)};Athlete.prototype.populate=function(n,t,i){var r,u;populateLenexChildObjects(this,n,t,i);this.fullname=this.firstname+" "+this.lastname;r=parseDateStr(this.birthdate);this.age=calcAgeAtDate(r,i.agedate.date);this.yob=1900+r.getYear();i.athletesLookup[this.athleteid]=this;u={};this.results.forEach(function(n){n.athleteid=this.athleteid;u[n.eventid]=n.resultid},this);this.entrys.forEach(function(n){var f,t,r;n.lane!==undefined&&(f=i.heatsLookup[n.heatid],t=new HeatLaneEntry(this.athleteid,n.entrytime,n.entrycourse),f.entriesByLane[n.lane]=t,r=u[n.eventid],r!=undefined&&(t.resultid=r))},this)};Result.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);i.resultsLookup[this.resultid]=this;this.seconds=parseTimeString(this.swimtime)};Heat.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);i.heatsLookup[this.heatid]=this};AgeGroup.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);this.rankings.sort(function(n,t){return n.place-t.place})};Split.prototype.populate=function(n,t,i){populateLenexChildObjects(this,n,t,i);this.seconds=parseTimeString(this.swimtime)};Event.prototype.hasStartLists=function(){return this.heats.length>0};Event.prototype.hasResults=function(){for(var n=0;n<this.agegroups.length;n++)if(this.agegroups[n].rankings.length>0)return!0;return!1};Session.prototype.hasStartLists=function(){for(var n=0;n<this.events.length;n++)if(this.events[n].hasStartLists())return!0;return!1};Session.prototype.hasResults=function(){for(var n=0;n<this.events.length;n++)if(this.events[n].hasResults())return!0;return!1};Meet.prototype.hasStartLists=function(){for(var n=0;n<this.sessions.length;n++)if(this.sessions[n].hasStartLists())return!0;return!1};Meet.prototype.hasResults=function(){for(var n=0;n<this.sessions.length;n++)if(this.sessions[n].hasResults())return!0;return!1};Lenex.prototype.tryLoad=function(n,t,i){var r=new XMLHttpRequest,u=this.urlFolderRoot+"/"+n,f=this;r.onload=function(){this.status==200?(console.info("Loaded "+u),populateLenexChildObjects(f,this.responseXML.documentElement,lenexDefinition),t()):(console.info("Failed to load "+u+". Error "+this.status),i(this.statusText))};r.onerror=function(){console.info("Failed to load "+u+". Error "+this.status);i(this.statusText)};r.open("GET",u,!0);r.send()};Lenex.prototype.tryLoadSessionFiles=function(n,t){var r,i;if(this.meets.length!=0)for(r=this.meets[0],i=0;i<r.sessions.length;i++)this.tryLoad(n+"s"+r.sessions[i].number+".xml",t,function(){})};Lenex.prototype.tryLoadEventFile=function(n,t,i){this.tryLoad("E"+n.number+".xml",t,i)};