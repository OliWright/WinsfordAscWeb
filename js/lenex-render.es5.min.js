"use strict";function createTextElement(n,t){var i=document.createElement(n);return i.appendChild(document.createTextNode(t)),i}function removeClass(n,t){var i;if(n.hasAttribute("class")){var f=n.getAttribute("class"),r=f.split(" "),u=Array();for(i=0;i<r.length;i++)r[i].length!=0&&r[i]!=t&&u.push(r[i]);n.setAttribute("class",u.join(" "))}}function addClass(n,t){var r,u,i;if(!n.hasAttribute("class")){n.setAttribute("class",t);return}for(r=n.getAttribute("class").split(" "),u=Array(),i=0;i<r.length;i++)r[i].length!=0&&r[i]!=t&&u.push(r[i]);u.push(t);n.setAttribute("class",u.join(" "))}function isClassSet(n,t){if(n.hasAttribute("class")){classes=n.getAttribute("class").split(" ");for(var i=0;i<classes.length;i++)if(classes[i]==t)return!0}return!1}function toggleClass(n,t){isClassSet(n,t)?removeClass(n,t):addClass(n,t)}function toggleBlockDisplay(n){n.style.display=n.style.display=="none"?"block":"none"}function raceTimeToString(n,t){var r,i,u;return n==0?"NT":(r=Math.floor(n/60),t===undefined&&(t=2),i="",r>0?(u=n-r*60,i+=r+":",u<10&&(i+="0"),i+=u.toFixed(t)):i+=n.toFixed(t),t==1&&(i+="0"),i)}function dateToStr(n){return n==undefined?"Date unknown":n.getDate().toString()+"/"+(n.getMonth()+1).toString()+"/"+n.getFullYear().toString()}function createRadioButton(n,t,i,r){var u=document.createElement("label");return u.setAttribute("for",i),u.appendChild(document.createTextNode(r)),n.appendChild(u),u=document.createElement("input"),u.setAttribute("type","radio"),u.setAttribute("name",t),u.setAttribute("value",i),u.setAttribute("id",i),n.appendChild(u),u}function createCheckBox(n,t,i,r){var u=document.createElement("label");return u.setAttribute("for",t),u.setAttribute("class",r),u.appendChild(document.createTextNode(i)),n.appendChild(u),u=document.createElement("input"),u.setAttribute("type","checkbox"),u.setAttribute("name",t),u.setAttribute("id",t),u.setAttribute("class",r),n.appendChild(u),u}function createDropDown(n,t){var i=document.createElement("select");return i.setAttribute("name",n),t.forEach(function(n){var t=document.createElement("option");t.setAttribute("value",n.value);t.appendChild(document.createTextNode(n.text));i.appendChild(t)}),i}function setSelectorClasses(n,t){for(var u=n.selectedIndex,r=n.options,i=0;i<n.length;i++)i==u?addClass(t,r[i].value):removeClass(t,r[i].value)}function fillDefaults(n,t){if(n==undefined)return t;var i={};return Object.keys(t).forEach(function(r){i[r]=n[r]!=undefined?n[r]:t[r]}),i}function createWhatToShowControl(n){var i=document.createElement("div"),t=createDropDown("what-to-show",[{value:"show-auto",text:"Results or start lists"},{value:"show-startlists",text:"Start lists"},{value:"show-results",text:"Results"},{value:"show-results-by-heat",text:"Results by heat"}]);return t.onchange=function(){setSelectorClasses(t,n)},setSelectorClasses(t,n),i.appendChild(t),i}function createSplitsModeControl(n){var i=document.createElement("div"),t=createDropDown("splits-mode",[{value:"splits-off",text:"Hide splits (click times to toggle)"},{value:"splits-time",text:"Show all splits as times"},{value:"splits-interval",text:"Show all splits as intervals"}]);return t.onchange=function(){setSelectorClasses(t,n)},setSelectorClasses(t,n),i.appendChild(t),i}function tryToLoadEventFile(n,t,i){markAsLoading(n.inlineEventInfoEl);n.separateEventInfoEl!=undefined&&n.separateEventInfoEl.lenexEvent===t&&markAsLoading(n.separateEventInfoEl);i.tryLoadEventFile(t,function(){console.info("Loaded event "+t.number);updateEventInfo(n.inlineEventInfoEl);n.separateEventInfoEl!=undefined&&n.separateEventInfoEl.lenexEvent===t&&updateEventInfo(n.separateEventInfoEl)},function(){console.info("Failed to load event "+t.number);updateEventInfo(n.inlineEventInfoEl);n.separateEventInfoEl!=undefined&&n.separateEventInfoEl.lenexEvent===t&&updateEventInfo(n.separateEventInfoEl)})}function eventClicked(n,t,i,r){var f=!1,u,e;r.mode==1?(toggleClass(n.inlineEventInfoEl,"closed"),f=!isClassSet(n.inlineEventInfoEl,"closed")):(u=n.separateEventInfoEl,u.lenex=r,u.lenexEvent=t,u.lenexMeet=i,u.innerHTML="",u.appendChild(createTextElement("h3",t.title())),e=document.createElement("div"),u.infoContainerEl=e,u.appendChild(e),updateEventInfo(u),f=!0);!t.hasResults()&&f&&tryToLoadEventFile(n,t,r)}function markAsLoading(n){var t=n.infoContainerEl,i;t.innerHTML="";i=createTextElement("p","Loading...");t.appendChild(i)}function updateEventInfo(n){var r=n.lenexEvent,u=n.lenexMeet,f=n.lenex,t=n.infoContainerEl,i;t.innerHTML="";r.hasStartLists()?(addClass(t,"has-startlists"),t.appendChild(r.renderStartLists(f,u))):(i=createTextElement("p","Start lists for this event are not available."),addClass(i,"startlists"),t.appendChild(i));r.hasResults()?(addClass(t,"has-results"),t.appendChild(r.renderResults(f,u)),t.appendChild(r.renderResultsByHeat(f,u))):(i=createTextElement("p","Results for this event are not available."),addClass(i,"results"),t.appendChild(i),i=createTextElement("p","Results for this event are not available."),addClass(i,"results-by-heat"),t.appendChild(i))}function cycleSplitsMode(n){isClassSet(n,"time")?(removeClass(n,"time"),addClass(n,"interval")):isClassSet(n,"interval")?removeClass(n,"interval"):addClass(n,"time")}function addColumnHeading(n,t,i){el=document.createElement("th");el.setAttribute("class",t);el.appendChild(document.createTextNode(i));n.appendChild(el)}function addAthleteColumnHeadings(n,t){addColumnHeading(n,"name","Name");t.customisation.options.showClub&&addColumnHeading(n,"club","Club");t.customisation.options.showYoB&&addColumnHeading(n,"yob","YoB");t.customisation.options.showAge&&addColumnHeading(n,"age","Age")}function LenexRender(n,t,i){var r=document.getElementById(t);r==null?alert("LenexRender was unable to find named element: "+t):(r.innerHTML="<p>Loading...<\/p>",LenexLoad(n,function(n){r.lenex=n;r.innerHTML="";i!=undefined?(n.customisation={},n.customisation.colours=fillDefaults(i.colours,defaultCustomisation.colours),n.customisation.options=fillDefaults(i.options,defaultCustomisation.options)):n.customisation=defaultCustomisation;n.customise();r.appendChild(n.render());n.setMode()},function(n){r.innerHTML="<p>Oh dear: "+n+"<\/p>"},function(){r.innerHTML="";r.appendChild(r.lenex.render());r.lenex.setMode()}))}var defaultCustomisation={colours:{headingsDark:"#33b",headingsLight:"#55e",text:"#666",background:"rgba(170, 170, 170, 0.4)",backgroundOddLines:"rgba(200, 200, 200, 0.4)"},options:{displayMode:0,showWatermark:!0,watermarkImage:"images/SportSystems.svg",showTitle:!0,showControls:!0,startSessionsCollapsed:!1,showColumnHeadings:!0,showClub:!0,showYoB:!0,showAge:!1}},customisationStyleSheet=undefined;Lenex.prototype.customise=function(){if(customisationStyleSheet==undefined){var n=document.createElement("style");n.appendChild(document.createTextNode(""));document.head.appendChild(n);customisationStyleSheet=n.sheet}customisationStyleSheet.insertRule(".lenex h1, .lenex h3, .lenex h4 { color: "+this.customisation.colours.headingsDark+"; }",0);customisationStyleSheet.insertRule(".lenex h2, .lenex h5 { color: "+this.customisation.colours.headingsLight+"; }",0);customisationStyleSheet.insertRule(".lenex { color: "+this.customisation.colours.text+"; }",0);customisationStyleSheet.insertRule("@media screen { .lenex .pane { background-color: "+this.customisation.colours.background+"; } }",0);customisationStyleSheet.insertRule(".lenex .odd { background-color: "+this.customisation.colours.backgroundOddLines+"; }",0);this.numColumns=3;this.customisation.options.showClub&&this.numColumns++;this.customisation.options.showYoB&&this.numColumns++;this.customisation.options.showAge&&this.numColumns++};Lenex.prototype.positionBackgroundImage=function(){var t=window.innerWidth,n,r,i;t=t==undefined?document.documentElement.clientWidth:t;n=window.innerHeight;n=n==undefined?document.documentElement.clientHeight:n;r=t<n?i=t:i=n;var u=(n-i)/2,f=(t-r)/2,e=-1e3,o=-1e3;(Math.abs(u-e)>30||Math.abs(f-o)>30)&&(e=u,o=f,this.backgroundImageEl.style.top=u.toString()+"px",this.backgroundImageEl.style.left=f.toString()+"px",this.backgroundImageEl.style.width=r.toString()+"px",this.backgroundImageEl.style.height=i.toString()+"px")};Lenex.prototype.setMode=function(){this.containerEl.clientWidth>768&&this.customisation.options.displayMode==0?this.mode!=0&&(removeClass(this.containerEl,"inline-results"),addClass(this.containerEl,"separate-results"),this.mode=0,this.meets.forEach(function(n){n.mode=0})):this.mode!=1&&(removeClass(this.containerEl,"separate-results"),addClass(this.containerEl,"inline-results"),this.mode=1,this.meets.forEach(function(n){n.mode=1}))};Lenex.prototype.handleEvent=function(n){switch(n.type){case"resize":this.backgroundImageEl!=undefined&&this.positionBackgroundImage();this.setMode()}};Lenex.prototype.render=function(){var t=document.createElement("div"),n,i;return t.setAttribute("class","lenex"),this.containerEl=t,this.mode=-1,this.eventTitleEls=[],this.customisation.options.showWatermark&&(n=document.createElement("img"),n.setAttribute("id","background-image"),n.setAttribute("src",this.customisation.options.watermarkImage),n.setAttribute("alt","Logo"),t.appendChild(n),this.backgroundImageEl=n,this.positionBackgroundImage()),window.addEventListener("resize",this),i=this,this.meets.forEach(function(n){t.appendChild(n.render(i))}),t};Meet.prototype.render=function(n){var t=document.createElement("div"),e,i,o,r,f,u;return t.setAttribute("id","meet"),addClass(t,"expand-selected"),n.customisation.options.showTitle&&(e=document.createElement("div"),addClass(e,"pane"),e.appendChild(createTextElement("h1",this.name)),t.appendChild(e)),t.hasAnyResults=this.hasResults(),t.hasAnyStartLists=this.hasStartLists(),n.customisation.options.showControls?(i=document.createElement("div"),i.setAttribute("id","controls"),addClass(i,"pane"),i.appendChild(createTextElement("h2","Controls")),i.appendChild(createTextElement("p","Click on an event to expand it to show startlists or results.  Click on a result time to show splits if available.  Click on the splits to toggle them between race times and intervals.")),t.hasAnyResults==t.hasAnyStartLists?i.appendChild(createWhatToShowControl(t)):t.hasAnyResults?addClass(t,"show-results"):addClass(t,"show-startlists"),i.appendChild(createSplitsModeControl(t)),o=createCheckBox(i,"expand-all","Expand all events","only-inline-results"),o.onclick=function(){n.eventTitleEls.forEach(function(t){var i=t.inlineEventInfoEl.lenexEvent;i.hasResults()||tryToLoadEventFile(t,i,n)});o.checked?removeClass(t,"expand-selected"):addClass(t,"expand-selected")},t.appendChild(i)):addClass(t,"show-auto"),r=document.createElement("div"),addClass(r,"flex-container"),t.appendChild(r),n.customisation.options.displayMode==0?(f=document.createElement("div"),f.setAttribute("id","index"),addClass(f,"pane"),r.appendChild(f),u=document.createElement("div"),addClass(u,"pane"),addClass(u,"only-separate-results"),r.appendChild(u),u.appendChild(createTextElement("p","Click on an event in the left-hand pane to see information here.")),this.sessions.forEach(function(t){f.appendChild(t.render(u,this,n))},this)):(addClass(r,"separate-sessions"),this.sessions.forEach(function(t){var i=document.createElement("div");addClass(i,"pane");r.appendChild(i);i.appendChild(t.render(undefined,this,n))},this)),t};Session.prototype.render=function(n,t,i){var u=document.createElement("div"),f=createTextElement("h2",this.name+" - "+dateToStr(this.date)),r=document.createElement("div");return i.customisation.options.startSessionsCollapsed&&r.setAttribute("class","hidden"),f.onclick=function(){toggleClass(r,"hidden")},u.appendChild(f),this.events.forEach(function(u){var e=u.renderTitle(),f=document.createElement("div");f.lenex=i;f.lenexEvent=u;f.lenexMeet=t;f.infoContainerEl=f;addClass(f,"closed");updateEventInfo(f);e.separateEventInfoEl=n;e.inlineEventInfoEl=f;e.onclick=function(){eventClicked(e,u,t,i)};i.eventTitleEls.push(e);r.appendChild(e);r.appendChild(f)}),u.appendChild(r),u};Event.prototype.title=function(){return"Event "+this.eventid+": "+this.swimstyle.name};Event.prototype.renderTitle=function(){var i=document.createElement("table"),n,t,r;return i.setAttribute("class","event-title"),n=document.createElement("tr"),t=document.createElement("td"),t.setAttribute("class","event-number"),t.appendChild(createTextElement("h3","Event "+this.eventid+":")),r=document.createElement("td"),r.appendChild(createTextElement("h3",this.swimstyle.name)),n.appendChild(t),n.appendChild(r),i.appendChild(n),i};Event.prototype.renderStartLists=function(n,t){var i=document.createElement("div");return addClass(i,"startlists"),i.appendChild(createTextElement("h4","Start Lists")),this.heats.forEach(function(r){i.appendChild(r.render(n,t))}),i};Event.prototype.renderResults=function(n,t){var i=document.createElement("div");return addClass(i,"results"),i.appendChild(createTextElement("h4","Results")),this.agegroups.forEach(function(r){i.appendChild(r.render(n,t))}),i};Event.prototype.renderResultsByHeat=function(n,t){var i=document.createElement("div");return addClass(i,"results-by-heat"),i.appendChild(createTextElement("h4","Results by Heat")),this.heats.forEach(function(r){i.appendChild(r.renderResults(n,t))}),i};AgeGroup.prototype.render=function(n,t){var u=document.createElement("div"),f=document.createElement("h4"),r,i,e;return f.appendChild(document.createTextNode(this.name)),u.appendChild(f),r=document.createElement("table"),n.customisation.options.showColumnHeadings&&(i=document.createElement("tr"),addColumnHeading(i,"place","P"),addAthleteColumnHeadings(i,n),addColumnHeading(i,"time","Time"),r.appendChild(i)),e=1,this.rankings.forEach(function(i){var u=t.resultsLookup[i.resultid];u.renderToTableWithSplits(r,i.place,e++,n,t)}),u.appendChild(r),u};Athlete.prototype.addDataToRow=function(n,t){el=document.createElement("td");el.setAttribute("class","name");el.appendChild(document.createTextNode(this.fullname));n.appendChild(el);t.customisation.options.showClub&&(el=document.createElement("td"),el.setAttribute("class","club"),el.appendChild(document.createTextNode(this.club.shortname)),n.appendChild(el));t.customisation.options.showYoB&&(el=document.createElement("td"),el.setAttribute("class","yob"),el.appendChild(document.createTextNode(this.yob)),n.appendChild(el));t.customisation.options.showAge&&(el=document.createElement("td"),el.setAttribute("class","age"),el.appendChild(document.createTextNode(this.age)),n.appendChild(el))};HeatLaneEntry.prototype.render=function(n,t,i){var f=i.athletesLookup[this.athleteid],u=document.createElement("tr"),e=(n&1)==1,r;return e&&addClass(u,"odd"),r=document.createElement("td"),r.setAttribute("class","place"),r.appendChild(document.createTextNode(n)),u.appendChild(r),f.addDataToRow(u,t),r=document.createElement("td"),r.setAttribute("class","time"),r.appendChild(document.createTextNode(raceTimeToString(this.entryTimeSeconds))),u.appendChild(r),u};Heat.prototype.render=function(n,t){var f=document.createElement("div"),o=document.createElement("h4"),u,i,r,e;for(o.appendChild(document.createTextNode("Heat "+this.number)),f.appendChild(o),u=document.createElement("table"),n.customisation.options.showColumnHeadings&&(i=document.createElement("tr"),addColumnHeading(i,"lane","L"),addAthleteColumnHeadings(i,n),addColumnHeading(i,"time","Entry"),u.appendChild(i)),r=0;r<this.entriesByLane.length;r++)e=this.entriesByLane[r],e!==undefined&&u.appendChild(e.render(r,n,t));return this.entriesByLane.forEach(function(){}),f.appendChild(u),f};Heat.prototype.renderResults=function(n,t){for(var f,e,i,o,r=[],u=0;u<this.entriesByLane.length;u++)f=this.entriesByLane[u],f!==undefined&&(e=f.resultid,e!=undefined&&r.push(t.resultsLookup[e]));r.sort(function(n,t){return n.seconds-t.seconds});i=document.createElement("div");o=document.createElement("h4");o.appendChild(document.createTextNode("Heat "+this.number));i.appendChild(o);var s=document.createElement("table"),h=1,c=1,l=0;return r.forEach(function(i){i.seconds!=l&&(c=h);i.renderToTableWithSplits(s,c,h++,n,t)}),i.appendChild(s),i};Result.prototype.renderToTableWithSplits=function(n,t,i,r,u){var o=(i&1)==1,e=this.render(t,r,u),f;o&&addClass(e,"odd");n.appendChild(e);this.splits.length>0&&(f=this.renderSplits(r),o&&addClass(f,"odd"),e.timeEl.onclick=function(){toggleClass(f,"show")},f.onclick=function(){toggleClass(f,"interval")},n.appendChild(f))};Result.prototype.render=function(n,t,i){var f=i.athletesLookup[this.athleteid],u=document.createElement("tr"),r=document.createElement("td");return r.appendChild(document.createTextNode(n)),r.setAttribute("class","place"),u.appendChild(r),f.addDataToRow(u,t),r=document.createElement("td"),u.timeEl=r,r.appendChild(document.createTextNode(raceTimeToString(this.seconds))),r.setAttribute("class","time"),u.appendChild(r),u};Result.prototype.renderSplits=function(n){var f=document.createElement("tr"),t,i,r,u,e;return f.setAttribute("class","splits-row"),t=document.createElement("td"),t.setAttribute("colspan",n.numColumns),i=document.createElement("div"),i.setAttribute("class","splits time"),this.splits.forEach(function(n){var t="",r;t+=n.distance;t+="m - ";t+=raceTimeToString(n.seconds);r=createTextElement("p",t);i.appendChild(r)}),t.appendChild(i),r=document.createElement("div"),r.setAttribute("class","splits interval"),u=0,e=!0,this.splits.forEach(function(n){var t="";t+=n.distance;(e||u!=0)&&n.seconds!=0?(t+="m - ",t+=raceTimeToString(n.seconds-u)):t+="m ---";u=n.seconds;e=!1;r.appendChild(createTextElement("p",t))}),t.appendChild(r),f.appendChild(t),f};